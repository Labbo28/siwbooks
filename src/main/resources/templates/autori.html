<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="fragments/head :: head('SIWBooks – Autori')"></head>
  <body class="bg-light">

    <header class="header border-bottom py-3 mb-4 bg-white shadow-sm">
      <div class="container d-flex justify-content-between align-items-center">
        <h2 class="mb-0">SIWBooks</h2>
        <nav class="main-nav">
          <a th:href="@{/}" class="btn btn-link">Home</a>
          <a th:href="@{/libri}" class="btn btn-link">Libri</a>
          <a th:href="@{/autori}" class="btn btn-link active">Autori</a>
        </nav>
      </div>
    </header>

    <main class="main-content py-5">
      <div class="container">

        <div class="d-flex justify-content-between align-items-center mb-4">
          <h1 class="display-5">Autori</h1>
          <div sec:authorize="hasRole('ADMIN')">
            <a th:href="@{/autori/new}" class="btn btn-success">
              <i class="fas fa-plus"></i> Nuovo Autore
            </a>
          </div>
        </div>

        <div class="search-container mb-4">
          <label for="searchAutori" class="form-label visually-hidden">Cerca Autori</label>
          <input id="searchAutori" type="text" class="form-control search-input"
                 placeholder="Cerca autori per nome o cognome…">
        </div>

        <ul id="autoriResults" class="list-group mb-4">
          <li th:each="a : ${autori}" class="list-group-item d-flex justify-content-between align-items-center">
            <a th:href="@{/autori/{id}(id=${a.id})}" th:text="${a.nome + ' ' + a.cognome}"
               class="flex-grow-1 text-decoration-none fw-semibold"></a>
            <span class="badge bg-secondary" th:text="${a.nazionalita}"></span>
          </li>
          <li th:if="${#lists.isEmpty(autori)}" class="list-group-item text-center text-muted">
            Nessun autore nel database.
          </li>
        </ul>

        <div class="text-center">
          <a th:href="@{/}" class="btn btn-outline-secondary">
            <i class="fas fa-home"></i> Torna alla Home
          </a>
        </div>

      </div>
    </main>

    <footer class="footer mt-auto py-3 bg-dark text-white">
      <div class="container text-center">
        <p class="mb-0">&copy; 2025 SIWBooks – Tutti i diritti riservati.</p>
       
      </div>
    </footer>

    <script>
      document.getElementById("searchAutori").addEventListener("input", function () {
        fetch(`/api/autori/search?query=${encodeURIComponent(this.value)}`)
          .then(response => response.json())
          .then(data => {
            const ul = document.getElementById("autoriResults");
            ul.innerHTML = '';
            if (!data.length) {
              ul.innerHTML = '<li class="list-group-item text-center text-muted">Nessun autore trovato.</li>';
              return;
            }
            data.forEach(a => {
              ul.innerHTML += `
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <a href="/autori/${a.id}" class="flex-grow-1 text-decoration-none fw-semibold">${a.nome} ${a.cognome}</a>
                  <span class="badge bg-secondary">${a.nazionalita}</span>
                    <img th:src="@{${a.immagine.path}}" th:alt="${a.nome}" class="rounded" style="max-width:200px;">
                </li>`;
            });
          });
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
